
@model Florist.Models.LoginViewModel

@{
    ViewData["Title"] = "Login & Registration";
     Layout = null;
}

   


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewData["Title"]</title>
    <link rel="stylesheet" href="~/css/logIn.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />

</head>
<body>
     <div class="container">
        <div id="LoginAndRegistrationForm">
            <!-- Login Form -->
            <div id="login-form">
                <h2>Giriş Yap</h2>
                <form id="loginForm">
                <input type="email" class="login" name="Email" placeholder="Email" required>
                    <input type="password" name="Sifre" placeholder="Password" required>
                    <button type="submit">Giriş Yap</button>
                </form>
                <p>Hesabın Yok Mu? <a href="#" id="show-register">Kayıt Ol</a></p>
                <p id="login-error" style="color: red;"></p>
            </div>

            <!-- Registration Form -->
            <div id="register-form" style="display: none;">
                <h2>Kayıt Ol</h2>
                <form id="registerForm">
                    <input type="text" name="Ad" placeholder="Ad" required>
                    <input type="text" name="Soyad" placeholder="Soyad" required>
                    <input type="email" name="Email" placeholder="Email" required>
                    <input type="text" name="KullaniciAdi" placeholder="Username" required>
                    <input type="password" name="Sifre" placeholder="Password" required>
                    <button type="submit">Kayıt Ol</button>
                </form>
                <p>Zateb Hesabın Var Mı? <a href="#" id="show-login">Giriş Yap</a></p>
                <p id="register-error" style="color: red;"></p>
            </div>

            <div id="ForgotPasswordForm" style="display: none;">
                <h2>Şifre Sıfırlama</h2>
                <form>
                    <input type="email" placeholder="E-posta adresinizi girin" required />
                    <button type="submit">Gönder</button>
                </form>
                <p style="text-align:center; margin-top: 10px;">
                    <a href="javascript:void(0);" onclick="ShowLoginForm()">Giriş sayfasına dön</a>
                </p>
            </div>

            <p style="text-align:center; margin-top: 10px;">
                <a href="javascript:void(0);" onclick="ShowForgotPasswordForm()">Şifremi Unuttum</a>
            </p>
           
        </div>

            <script>
                document.getElementById("show-register").addEventListener("click", function () {
                  document.getElementById("login-form").style.display = "none";
                  document.getElementById("register-form").style.display = "block";
                });

                document.getElementById("show-login").addEventListener("click", function () {
                  document.getElementById("register-form").style.display = "none";
                  document.getElementById("login-form").style.display = "block";
                });

                               // AJAX ile Register İşlemi
                document.getElementById("registerForm").addEventListener("submit", function (e) {
                    e.preventDefault(); // Sayfa yenilemesini engelle

                    var formData = new FormData(this); // Formu alıyoruz

                    // FormData'nın içeriğini konsola yazdırarak kontrol edelim
                    for (var pair of formData.entries()) {
                        console.log(pair[0]+ ': ' + pair[1]);
                    }

                    fetch("/Account/Register", {
                        method: "POST",
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert("Kayıt başarılı, giriş yapabilirsiniz!");
                            document.getElementById("register-form").style.display = "none";
                            document.getElementById("login-form").style.display = "block";  // Kullanıcıyı login formuna yönlendir
                        } else {
                            if (data.details) {
                                document.getElementById("register-error").innerText = data.details.join("\n");  // Hataları yazdır
                            } else {
                                document.getElementById("register-error").innerText = data.error;  // Genel hata mesajı
                            }
                        }
                    })
                    .catch(error => console.error("Error:", error));
                });




                // AJAX ile Login İşlemi
                document.getElementById("loginForm").addEventListener("submit", function (e) {
                  e.preventDefault();

                  var formData = new FormData(this);

                  fetch("/Account/Login", {
                    method: "POST",
                    body: formData
                  })
                  .then(response => response.json())
                  .then(data => {
                    if (data.success) {
  
                      alert(`Hoş geldiniz ! Alışverişe Başlayabilirsiniz <3`);
                      window.location.href = "/Home/Urunler"; // Başarılı giriş sonrası yönlendirme
                    } else {
                      document.getElementById("login-error").innerText = "Hatalı email veya şifre!";
                    }
                  })
                  .catch(error => console.error("Error:", error));
                });
            </script>





       
    </>

    <script src="~/js/logIn.js" type="text/javascript"></script>
    <script src="~/js/validation.js" type="text/javascript"></script>

    <script>
                document.getElementById("registerForm").addEventListener("submit", function (e) {
            e.preventDefault(); // Sayfa yenilemesini engelle

            var formData = new FormData(this);

            // FormData'nın içeriğini konsola yazdırarak kontrol edelim
            for (var pair of formData.entries()) {
                console.log(pair[0]+ ': ' + pair[1]);
            }

            fetch("/Account/Register", {
                method: "POST",
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("Kayıt başarılı, giriş yapabilirsiniz!");
                    document.getElementById("register-form").style.display = "none";
                    document.getElementById("login-form").style.display = "block";  // Kullanıcıyı login formuna yönlendir
                } else {
                    if (data.details) {
                        document.getElementById("register-error").innerText = data.details.join("\n");  // Hataları yazdır
                    } else {
                        document.getElementById("register-error").innerText = data.error;  // Genel hata mesajı
                    }
                }
            })
            .catch(error => console.error("Error:", error));
        });

    </script>
        <script>
            function ShowForgotPasswordForm() {
                document.getElementById("login-form").style.display = "none";
                document.getElementById("register-form").style.display = "none";
                document.getElementById("ForgotPasswordForm").style.display = "block";
            }

            function ShowLoginForm() {
                document.getElementById("login-form").style.display = "block";
                document.getElementById("register-form").style.display = "none";
                document.getElementById("ForgotPasswordForm").style.display = "none";
            }
        </script>

</body>
</html>